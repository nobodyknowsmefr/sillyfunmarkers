<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Shape Store</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- SVG Filter for Halftone Effect -->
    <svg style="position: absolute; width: 0; height: 0;">
        <defs>
            <filter id="halftone" x="0" y="0" width="100%" height="100%">
                <feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
                <feComponentTransfer in="blur" result="contrast">
                    <feFuncR type="discrete" tableValues="0 0.2 0.4 0.6 0.8 1"/>
                    <feFuncG type="discrete" tableValues="0 0.2 0.4 0.6 0.8 1"/>
                    <feFuncB type="discrete" tableValues="0 0.2 0.4 0.6 0.8 1"/>
                </feComponentTransfer>
            </filter>
            <pattern id="dots" patternUnits="userSpaceOnUse" width="4" height="4">
                <circle cx="2" cy="2" r="1.5" fill="#000" opacity="0.3"/>
            </pattern>
        </defs>
    </svg>

    <!-- Windows 98 Browser Chrome -->
    <div class="win98-browser">
        <!-- Title Bar -->
        <div class="win98-titlebar">
            <div class="win98-title">
                <div class="win98-title-icon">◆</div>
                The Shape Store - Internet Explorer
            </div>
            <div class="win98-controls">
                <div class="win98-ctrl-btn">_</div>
                <div class="win98-ctrl-btn">□</div>
                <div class="win98-ctrl-btn">×</div>
            </div>
        </div>
        
        <!-- Menu Bar -->
        <div class="win98-menubar">
            <span class="win98-menu-item">File</span>
            <span class="win98-menu-item">Edit</span>
            <span class="win98-menu-item">View</span>
            <span class="win98-menu-item">Favorites</span>
            <span class="win98-menu-item">Help</span>
        </div>
        
        <!-- Toolbar -->
        <div class="win98-toolbar">
            <div class="win98-toolbar-buttons">
                <a href="javascript:history.back()" class="win98-tool-btn">
                    <div class="tool-icon">←</div>
                    <div class="tool-label">Back</div>
                </a>
                <a href="javascript:history.forward()" class="win98-tool-btn">
                    <div class="tool-icon">→</div>
                    <div class="tool-label">Forward</div>
                </a>
                <a href="index.html" class="win98-tool-btn">
                    <div class="tool-icon">
                        <svg width="16" height="16" viewBox="0 0 16 16">
                            <polygon points="8,1 1,8 4,8 4,15 12,15 12,8 15,8" fill="none" stroke="#000" stroke-width="1.5"/>
                            <rect x="6" y="10" width="4" height="5" fill="#000"/>
                        </svg>
                    </div>
                    <div class="tool-label">Home</div>
                </a>
                <div class="win98-tool-btn" onclick="location.reload()">
                    <div class="tool-icon">
                        <svg width="16" height="16" viewBox="0 0 16 16">
                            <path d="M8,2 A6,6 0 1,1 2,8" fill="none" stroke="#000" stroke-width="1.5"/>
                            <polygon points="8,0 8,5 4,2.5" fill="#000"/>
                        </svg>
                    </div>
                    <div class="tool-label">Refresh</div>
                </div>
            </div>
        </div>
        
        <!-- Address Bar -->
        <div class="win98-addressbar">
            <span class="address-label">Address</span>
            <div class="address-input">
                <span class="address-icon">
                    <svg width="12" height="14" viewBox="0 0 12 14">
                        <rect x="0" y="0" width="10" height="14" fill="none" stroke="#000" stroke-width="1"/>
                        <line x1="2" y1="4" x2="8" y2="4" stroke="#000" stroke-width="1"/>
                        <line x1="2" y1="7" x2="8" y2="7" stroke="#000" stroke-width="1"/>
                        <line x1="2" y1="10" x2="6" y2="10" stroke="#000" stroke-width="1"/>
                    </svg>
                </span>
                https://theshapestore.com/shop
            </div>
            <div class="win98-go-btn">Go</div>
        </div>
    </div>

    <!-- Logo Section -->
    <header class="logo-section">
        <img src="logoshapestore.png" alt="The Shape Store" class="logo">
    </header>

    <!-- 3D Door Portal -->
    <div id="door-section">
        <div id="door-container"></div>
    </div>

    <!-- Shopify Buy Button Container -->
    <div id="shopify-collection" class="shopify-container">
        <div id='product-component-1772131504141'></div>
    </div>

    <!-- Mini Game UI -->
    <div id="game-ui" class="game-ui hidden">
        <div class="game-header">
            <div class="timer-display">
                <span class="timer-label">TIME</span>
                <span id="timer">30</span>
            </div>
            <div class="game-score">
                <span class="score-label">SORTED</span>
                <span><span id="sorted-count">0</span> / <span id="target-count">5</span></span>
            </div>
        </div>
    </div>

    <!-- 3D Bucket Container -->
    <div id="bucket-container" class="bucket-container hidden">
        <canvas id="bucket-canvas"></canvas>
        <div class="bucket-labels">
            <div class="bucket-label yellow-label">YELLOW</div>
            <div class="bucket-label cube-label">CUBES</div>
        </div>
    </div>

    <!-- Discount Popup - Rhombus Design -->
    <div id="discount-popup" class="discount-popup hidden">
        <div class="rhombus-container">
            <div class="rhombus-shape">
                <div class="slice slice-top"></div>
                <div class="slice slice-right"></div>
                <div class="slice slice-bottom"></div>
                <div class="slice slice-left"></div>
                <div class="rhombus-inner">
                    <div class="code-reveal">
                        <span class="code-label">YOUR CODE</span>
                        <img src="shapecode.png" alt="Discount Code" class="discount-code-img" id="discount-code">
                    </div>
                </div>
            </div>
        </div>
        <button id="close-popup-btn" class="close-btn-minimal"><img src="tap.png" alt="Tap to Continue" class="tap-img"></button>
    </div>

    <!-- Canvas for Falling Shapes -->
    <canvas id="shapes-canvas"></canvas>

    <!-- Now Playing Popup -->
    <div id="now-playing-popup" class="now-playing-popup hidden">
        <div class="now-playing-content">
            <span id="now-playing-status">Now Playing</span>
            <span class="now-playing-song">shapetheme.wav</span>
        </div>
    </div>

    <!-- Windows 98 Taskbar -->
    <div class="win98-taskbar">
        <button class="win98-start-btn" onclick="toggleStartMenu()">
            <svg class="start-shape" width="16" height="16" viewBox="0 0 16 16">
                <polygon points="8,1 15,14 1,14" fill="#ff0000" stroke="#000" stroke-width="1"/>
                <rect x="3" y="5" width="4" height="4" fill="#ffff00" stroke="#000" stroke-width="0.5"/>
                <circle cx="12" cy="8" r="2.5" fill="#0000ff" stroke="#000" stroke-width="0.5"/>
            </svg>
            <span class="start-text">Bird Game Studios</span>
        </button>
        <div class="taskbar-divider"></div>
        <div class="taskbar-windows">
            <div class="taskbar-window-btn active">
                <span class="taskbar-window-icon">◆</span>
                The Shape Store
            </div>
        </div>
        <div class="taskbar-tray">
            <div class="tray-music" id="music-toggle" onclick="toggleMusic()">
                <svg width="12" height="12" viewBox="0 0 12 12">
                    <polygon id="music-icon" points="3,1 3,11 10,6" fill="#000"/>
                </svg>
            </div>
            <div class="tray-clock" onclick="toggleCalendar()">
                <span id="taskbar-time">12:00 PM</span>
            </div>
        </div>
    </div>

    <!-- Start Menu -->
    <div id="start-menu" class="win98-start-menu hidden">
        <div class="start-menu-sidebar">
            <span class="sidebar-text">Bird Script</span>
        </div>
        <div class="start-menu-content">
            <div class="start-menu-item">
                <span class="menu-icon-box"></span>
                <span>Programs</span>
                <span class="menu-arrow">▶</span>
            </div>
            <div class="start-menu-item">
                <span class="menu-icon-doc"></span>
                <span>Documents</span>
                <span class="menu-arrow">▶</span>
            </div>
            <div class="start-menu-item">
                <span class="menu-icon-gear"></span>
                <span>Settings</span>
                <span class="menu-arrow">▶</span>
            </div>
            <div class="start-menu-item">
                <span class="menu-icon-search"></span>
                <span>Find</span>
                <span class="menu-arrow">▶</span>
            </div>
            <div class="start-menu-item">
                <span class="menu-icon-help"></span>
                <span>Help</span>
            </div>
            <div class="start-menu-divider"></div>
            <div class="start-menu-item">
                <span class="menu-icon-exit"></span>
                <span>Shut Down...</span>
            </div>
        </div>
    </div>

    <!-- Calendar Popup -->
    <div id="calendar-popup" class="win98-calendar hidden">
        <div class="calendar-titlebar">
            <span>Date/Time Properties</span>
            <div class="calendar-close" onclick="toggleCalendar()">×</div>
        </div>
        <div class="calendar-content">
            <div class="calendar-header">
                <button class="cal-nav">◀</button>
                <span id="calendar-month">February 2006</span>
                <button class="cal-nav">▶</button>
            </div>
            <div class="calendar-grid">
                <div class="cal-day-header">Su</div>
                <div class="cal-day-header">Mo</div>
                <div class="cal-day-header">Tu</div>
                <div class="cal-day-header">We</div>
                <div class="cal-day-header">Th</div>
                <div class="cal-day-header">Fr</div>
                <div class="cal-day-header">Sa</div>
                <div class="cal-day">1</div>
                <div class="cal-day">2</div>
                <div class="cal-day">3</div>
                <div class="cal-day">4</div>
                <div class="cal-day">5</div>
                <div class="cal-day">6</div>
                <div class="cal-day">7</div>
                <div class="cal-day">8</div>
                <div class="cal-day">9</div>
                <div class="cal-day">10</div>
                <div class="cal-day">11</div>
                <div class="cal-day">12</div>
                <div class="cal-day">13</div>
                <div class="cal-day">14</div>
                <div class="cal-day">15</div>
                <div class="cal-day">16</div>
                <div class="cal-day">17</div>
                <div class="cal-day">18</div>
                <div class="cal-day">19</div>
                <div class="cal-day">20</div>
                <div class="cal-day">21</div>
                <div class="cal-day">22</div>
                <div class="cal-day">23</div>
                <div class="cal-day">24</div>
                <div class="cal-day">25</div>
                <div class="cal-day">26</div>
                <div class="cal-day today">27</div>
                <div class="cal-day">28</div>
                <div class="cal-day">29</div>
                <div class="cal-day">30</div>
                <div class="cal-day">31</div>
                <div class="cal-day">32</div>
                <div class="cal-day">33</div>
                <div class="cal-day">34</div>
                <div class="cal-day">35</div>
                <div class="cal-day">36</div>
                <div class="cal-day">37</div>
                <div class="cal-day">38</div>
                <div class="cal-day">39</div>
                <div class="cal-day">40</div>
                <div class="cal-day">41</div>
                <div class="cal-day">42</div>
                <div class="cal-day">43</div>
                <div class="cal-day">44</div>
                <div class="cal-day">45</div>
                <div class="cal-day">46</div>
                <div class="cal-day">47</div>
                <div class="cal-day">48</div>
                <div class="cal-day">49</div>
                <div class="cal-day">50</div>
                <div class="cal-day">51</div>
                <div class="cal-day">52</div>
                <div class="cal-day">53</div>
            </div>
        </div>
    </div>

    <!-- Taskbar Scripts -->
    <script>
        // Update clock
        function updateClock() {
            const now = new Date();
            let hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12 || 12;
            document.getElementById('taskbar-time').textContent = `${hours}:${minutes} ${ampm}`;
        }
        updateClock();
        setInterval(updateClock, 1000);

        // Toggle start menu
        function toggleStartMenu() {
            const menu = document.getElementById('start-menu');
            const calendar = document.getElementById('calendar-popup');
            calendar.classList.add('hidden');
            menu.classList.toggle('hidden');
        }

        // Toggle calendar
        function toggleCalendar() {
            const calendar = document.getElementById('calendar-popup');
            const menu = document.getElementById('start-menu');
            menu.classList.add('hidden');
            calendar.classList.toggle('hidden');
        }

        // Close menus when clicking outside
        document.addEventListener('click', function(e) {
            const startMenu = document.getElementById('start-menu');
            const calendar = document.getElementById('calendar-popup');
            const startBtn = document.querySelector('.win98-start-btn');
            const clock = document.querySelector('.tray-clock');
            
            if (!startMenu.contains(e.target) && !startBtn.contains(e.target)) {
                startMenu.classList.add('hidden');
            }
            if (!calendar.contains(e.target) && !clock.contains(e.target)) {
                calendar.classList.add('hidden');
            }
        });

        // Music player with Safari fix
        let bgMusic = null;
        let musicPlaying = false;
        const songName = 'shapetheme.wav';

        function initMusic() {
            if (!bgMusic) {
                bgMusic = new Audio(songName);
                bgMusic.loop = true;
                bgMusic.volume = 0.5;
                // Safari requires user interaction, so we load it
                bgMusic.load();
            }
        }

        function showNowPlaying() {
            const popup = document.getElementById('now-playing-popup');
            popup.classList.remove('hidden');
            popup.classList.add('show');
            
            // Hide after 3 seconds
            setTimeout(() => {
                popup.classList.remove('show');
                setTimeout(() => popup.classList.add('hidden'), 300);
            }, 3000);
        }

        function toggleMusic() {
            initMusic();
            const icon = document.getElementById('music-icon');
            const statusText = document.getElementById('now-playing-status');
            
            if (musicPlaying) {
                bgMusic.pause();
                musicPlaying = false;
                // Play icon (triangle)
                icon.setAttribute('points', '3,1 3,11 10,6');
                statusText.textContent = 'Paused';
                showNowPlaying();
            } else {
                // Safari/WebKit fix: play on user interaction
                const playPromise = bgMusic.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        musicPlaying = true;
                        // Pause icon (two bars)
                        icon.setAttribute('points', '2,1 2,11 5,11 5,1 7,1 7,11 10,11 10,1');
                        statusText.textContent = 'Now Playing';
                        showNowPlaying();
                    }).catch(err => {
                        console.log('Audio play failed:', err);
                    });
                }
            }
        }

        // Autoplay on page load
        function autoplayMusic() {
            initMusic();
            const icon = document.getElementById('music-icon');
            const statusText = document.getElementById('now-playing-status');
            
            const playPromise = bgMusic.play();
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    musicPlaying = true;
                    icon.setAttribute('points', '2,1 2,11 5,11 5,1 7,1 7,11 10,11 10,1');
                    statusText.textContent = 'Now Playing';
                    showNowPlaying();
                }).catch(err => {
                    // Autoplay blocked - wait for user interaction
                    console.log('Autoplay blocked, waiting for user interaction');
                    document.addEventListener('click', function startOnClick() {
                        if (!musicPlaying) {
                            bgMusic.play().then(() => {
                                musicPlaying = true;
                                icon.setAttribute('points', '2,1 2,11 5,11 5,1 7,1 7,11 10,11 10,1');
                                statusText.textContent = 'Now Playing';
                                showNowPlaying();
                            });
                        }
                        document.removeEventListener('click', startOnClick);
                    }, { once: true });
                });
            }
        }

        // Start music when page loads
        window.addEventListener('load', autoplayMusic);
    </script>

    <!-- Matter.js Physics Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <!-- Three.js for 3D Buckets -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="script.js"></script>
    <script src="buckets.js"></script>
    <script src="door3d.js"></script>
    
    <!-- Shopify Buy Button -->
    <script type="text/javascript">
    (function () {
      var scriptURL = 'https://sdks.shopifycdn.com/buy-button/latest/buy-button-storefront.min.js';
      if (window.ShopifyBuy) {
        if (window.ShopifyBuy.UI) {
          ShopifyBuyInit();
        } else {
          loadScript();
        }
      } else {
        loadScript();
      }
      function loadScript() {
        var script = document.createElement('script');
        script.async = true;
        script.src = scriptURL;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(script);
        script.onload = ShopifyBuyInit;
      }
      function ShopifyBuyInit() {
        var client = ShopifyBuy.buildClient({
          domain: '41ic0w-2f.myshopify.com',
          storefrontAccessToken: '6e54032e3f45a6f5eae1c08fedff0078',
        });
        ShopifyBuy.UI.onReady(client).then(function (ui) {
          ui.createComponent('product', {
            id: '8665942524057',
            node: document.getElementById('product-component-1772131504141'),
            moneyFormat: '%24%7B%7Bamount%7D%7D',
            options: {
              "product": {
                "styles": {
                  "product": {
                    "@media (min-width: 601px)": {
                      "max-width": "calc(25% - 20px)",
                      "margin-left": "20px",
                      "margin-bottom": "50px"
                    }
                  }
                },
                "text": {
                  "button": "Add to cart"
                }
              },
              "productSet": {
                "styles": {
                  "products": {
                    "@media (min-width: 601px)": {
                      "margin-left": "-20px"
                    }
                  }
                }
              },
              "modalProduct": {
                "contents": {
                  "img": false,
                  "imgWithCarousel": true,
                  "button": false,
                  "buttonWithQuantity": true
                },
                "styles": {
                  "product": {
                    "@media (min-width: 601px)": {
                      "max-width": "100%",
                      "margin-left": "0px",
                      "margin-bottom": "0px"
                    }
                  }
                },
                "text": {
                  "button": "Add to cart"
                }
              },
              "option": {},
              "cart": {
                "text": {
                  "total": "Subtotal",
                  "button": "Checkout"
                }
              },
              "toggle": {}
            },
          });
        });
      }
    })();
    </script>
</body>
</html>
